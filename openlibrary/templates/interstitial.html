$def with(url, provider_name="", wait=5)

$if provider_name == None:
  $ provider_name = ""

<h1>$_("You are being redirected to your book")</h1>

<p id="countdown">$:_('This book is provided by <strong>%(book_provider)s</strong>, a third-party Open Library Trusted Book Provider', book_provider=websafe(provider_name))</p>

<p>$:_('You will be automatically redirected to <strong>%(book_provider_url)s</strong> in <span id="timer">5</span> seconds...', book_provider_url=url)</p>

<p>
  <a href="#" onclick="window.close(); return false;">$_("Cancel")</a> |
  <a href="${url}">$_("Continue without waiting")</a>
</p>

<script>
  let count = $wait;
  const timerElement = document.getElementById("timer");

  const countdown = setInterval(() => {
    count--;
    timerElement.textContent = count;

    if (count === 0) {
      clearInterval(countdown);
      window.location.href = '$url';
    }
  }, 1000);
</script>

